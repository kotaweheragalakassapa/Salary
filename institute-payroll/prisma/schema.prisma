generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model User {
  id       Int    @id @default(autoincrement())
  username String @unique
  password String
  role     String // ADMIN, STAFF
}

model Teacher {
  id          Int      @id @default(autoincrement())
  name        String   @unique
  phone       String   @unique
  username    String   @unique @default("")
  password    String   @default("")
  address     String?
  image       String?
  createdAt   DateTime @default(now())
  
  // Relations
  rates       TeacherRate[]
  collections DailyCollection[]
  deductions  Deduction[]
}

model Class {
  id                 Int      @id @default(autoincrement())
  name               String
  feePerStudent      Float    @default(0) // Class fee per student (e.g., 1000)
  tuteCostPerStudent Float    @default(0) // Tute cost per student
  postalFeePerStudent Float   @default(0) // Postal fee per student
  instituteFeePercentage Float @default(0) // Percentage of total collection (e.g., 20)
  createdAt          DateTime @default(now())

  // Relations
  rates       TeacherRate[]
  collections DailyCollection[]
}

model TeacherRate {
  id        Int   @id @default(autoincrement())
  teacherId Int
  classId   Int
  percentage Float

  teacher   Teacher @relation(fields: [teacherId], references: [id])
  class     Class   @relation(fields: [classId], references: [id])

  @@unique([teacherId, classId]) // One rate per teacher-class pair
}

model DailyCollection {
  id             Int      @id @default(autoincrement())
  date           DateTime
  amount         Float    // Total amount collected (calculated: studentCount Ã— class.feePerStudent)
  studentCount   Int      @default(0) // Number of students present on this day
  tuteCostPerStudent Float  @default(0) // Added for daily variation
  postalFeePerStudent Float @default(0) // Added for daily variation
  teacherId      Int
  classId        Int
  
  teacher   Teacher @relation(fields: [teacherId], references: [id])
  class     Class   @relation(fields: [classId], references: [id])
  createdAt DateTime @default(now())
}

model Deduction {
  id          Int      @id @default(autoincrement())
  teacherId   Int
  type        String   // TUTE, ADVANCE
  amount      Float
  date        DateTime
  description String?
  createdAt   DateTime @default(now())

  teacher     Teacher @relation(fields: [teacherId], references: [id])
}
